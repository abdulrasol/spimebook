{% extends "posts/base.html" %}
{% load static %}
{% load books_extra %}
{% block content %}
{# get user lang to show correct translate #}
{% if user.is_authenticated %}
{% define user.profile.lang as user_lang %}
{% else %}
{% define 'en' as user_lang %}
{% endif %}
<link rel="stylesheet" href="{% static 'css/jquery-ui.css'%}">
<script src="{% static 'js/jquery-ui.min.js' %}"></script>
<form method="POST" enctype="multipart/form-data" class="uk uk-padding uk-padding-remove-vertical">
    {% csrf_token %}
    <legend class="uk-legend uk-margin-bottom">Edit {{post.title}} </legend>
    <div class="uk-grid" uk-grid>
        <div class="uk-width-1-1@s">
            {% for message in messages %}
            <div class="uk-margin uk-margin-large-top">
                <div class="uk-alert-warning existed" uk-alert>
                    <p>
                        {{message}}<a href="{% url 'add-book' %}">click here</a> to add book
                    </p>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="uk-width-1-1@s">
            <label style="display: block;" class="uk-form-label uk-margin-small-bottom">Title</label>
            <input type="text" name="title" value="{{post.title}}" maxlength="120" placeholder="Post Title" required
                class="uk-input" id="id_title">
        </div>
        <div class="uk-margin uk-width-1-1">
            <label style="display: block;" class="uk-form-label uk-margin-small-bottom" for="form-stacked-text">Book
                Post</label>
            <div class="uk-form-controls">
                <textarea name="content" cols="40" rows="5" required class="uk-textarea uk-padding-small"
                    id="id_content">{{post.content}}</textarea>
            </div>
        </div>
        <div class="uk-width-1-1 book-list-container">
            <label style="display: block;" class="uk-form-label uk-margin-small-bottom">Book</label>
            <ul uk-accordion>
                <li>
                    <a id="select-book" class="uk-accordion-title" href="#">Select Book</a>
                    <div class="uk-accordion-content">
                        <input type="search" class="uk-input book-filter" id="filter" placeholder="Book Title">
                        <div style="max-height: 250px; overflow-y: auto;" id="books-list"
                            class="uk-margin uk-grid-small uk-child-width-auto uk-grid">
                        </div>
                    </div>
                </li>
            </ul>
            <span style="display: block;" class="uk-margin-small-top uk-text-muted author-autocomplete">
                If Book Doesn't Appear
                <a href="{% url 'books:add-book' %}">click here to
                    add</a>
            </span>
        </div>
        <div class="uk-width-1-2@s">
            <label style="display: block;" class="uk-form-label uk-margin-small-bottom">Type</label>
            <select name="post_type" class="uk-select" id="id_post_type">
                {% if post.post_type == 'Q'  %}
                <option value="Q" selected>Quote</option>
                <option value="R">Review</option>
                <option value="P">Post</option>
                {% elif post.post_type == 'R'%}
                <option value="Q">Quote</option>
                <option value="R" selected>Review</option>
                <option value="P">Post</option>
                {% else  %}
                <option value="Q">Quote</option>
                <option value="R">Review</option>
                <option value="P" selected>Post</option>
                {% endif %}
            </select>
        </div>
        <div class="uk-width-auto@s">
            <label style="display: block;" class="uk-form-label uk-margin-small-bottom">Archived</label>
            <input type="checkbox" {% if post.archived %} checked {% endif %} name="archiving" class="uk-checkbox"
                id="id_archived">
            <label class="" for="id_archived">is archived post?</label>
            <p>
                When Archiving Posts, will no longer be visible for others.
            </p>
        </div>

        <div class="uk-width-1-1">
            <button type="submit" class="uk-button uk-button-primary">Save Book</button>
        </div>
    </div>
</form>

{% endblock content %}
{% block javascript %}
<script>
    $(function () {
        var books_list = $('#books-list');
        var URL_P = '{% url "reactions:all-books" %}';
        $.ajax({
            type: "GET",
            url: URL_P,
            success: function (response) {
                response.content.forEach(book => {
                    var elemet = `<div filter='${book.title}' style='margin:2px;disply:inline-block'><label><input class="uk-radio" value="${book.id}" type="radio" name="for_book"> ${book.title}</label></div>`
                    books_list.append(elemet);
                });
            }
        });
        let filter = $('.book-list-container input[type=search]')
        filter.on({
            "keydown": function (e) {
                value = $(this).val()
                books_list.find(`div:not([filter=${value}])`).hide();
                if ($(this).value === '') {
                    books_list.find(`div`).show();
                }
            },
            "keyup": function () {
                value = $(this).val()
                books_list.find(`:contains(${value})`).show();
                if ($(this).value === '') {
                    books_list.find(`div`).show();
                }
            }
        });
    });
</script>
{% endblock javascript %}